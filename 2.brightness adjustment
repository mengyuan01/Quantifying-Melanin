from PIL import Image, ImageEnhance
import os
import numpy as np

input_dir = 
output_dir =
reference_image_path = ".jpg"

if not os.path.exists(output_dir):
    os.makedirs(output_dir)

def calculate_average_brightness(image):
    gray_image = image.convert('L')
    return np.mean(gray_image)

try:
    reference_image = Image.open(reference_image_path)
    reference_brightness = calculate_average_brightness(reference_image)
    print(f" {reference_brightness:.2f}")
except Exception as e:
    print(f"error: {e}")
    exit()

print(f" {os.listdir(input_dir)}")

for filename in os.listdir(input_dir):
    if filename.lower().endswith(('.jpg', '.jpeg')):
        img_path = os.path.join(input_dir, filename)
        try:
            img = Image.open(img_path)
            print(f"success: {filename}")
        except Exception as e:
            print(f"fail {filename}: {e}")
            continue

        current_brightness = calculate_average_brightness(img)
        print(f"'{filename}' : {current_brightness:.2f}")

        if current_brightness == 0: 
            print(f"warning: '{filename}':0")
            continue
        else:
            brightness_factor = reference_brightness / current_brightness
        print(f"factor: {brightness_factor:.2f}")

        enhancer = ImageEnhance.Brightness(img)
        img_enhanced = enhancer.enhance(brightness_factor)

        output_path = os.path.join(output_dir, filename)
        try:
            img_enhanced.save(output_path)
            print(f"success: {output_path}")
        except Exception as e:
            print(f"fail {output_path}: {e}")

print("All done.")
